<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Form</title>
    <style>
        body {
            font-family: Arial, Helvetica, sans-serif;
        }

        #left-side {
            width: 45%;
        }

        #right-side {
            width: 45%;
            display: flex;
            flex-direction: column;
        }

        #lower-right {
            margin-top: 20px;
        }

        #container {
            display: flex;
            justify-content: space-between;
            margin: 20px;
        }

        img {
            max-width: 100%;
            height: auto;
        }

        .valid {
            color: green;
        }

        .invalid {
            color: red;
        }
    </style>
</head>

<body>
    <div id="container">
        <!--Left Side Input Fields-->
        <div id="left-side">
            <h2> Enter Student Information</h2>
            <label for="firstName">First Name:</label>
            <input type="text" id="firstName" name="firstName">
            <br>
            <label for="lastName">Last Name:</label>
            <input type="text" id="lastName" name="lastName">
            <br>
            <label for="email">Email:</label>
            <input type="email" id="email" name="email">
            <br>
            <label for="caoNumber">CAO Number:</label>
            <input type="text" id="caoNumber" name="caoNumber">
            <br>
            <label for="gender">Gender:</label>
            <select id="gender" name="gender">
                <option value="male">Male</option>
                <option value="female">Female</option>
                <option value="unknown">Unknown</option>
            </select>
            <br>
            <label>Courses:</label>
            <br>
            <input type="radio" id="course-choice1" name="course" value="Computing">
            <label for="computing">BSc Computing</label>
            <br>
            <input type="radio" id="course-choice2" name="course" value="Applied">
            <label for="applied">Applied Computing</label>
            <br>
            <input type="radio" id="course-choice3" name="course" value="Games">
            <label for="games">Games Programming</label>
            <br>
            <input type="checkbox" id="terms" name="terms">
            <label for="terms">I agree to the terms and conditions</label>
            <br>
            <button id="addStudentButton">Add Student</button>
            <button id="removeStudentButton">Remove Student</button>
        </div>
        <!--Right Side Student Display-->
        <div id="right-side">
            <h2>Registered Students</h2>
            <div id="computing-students" class="course-students"></div>
            <div id="applied-students" class="course-students"></div>
            <div id="games-students" class="course-students"></div>
        </div>
    </div>
    <div id="lower-right">
        <h3>Student Information</h3>
        <p>Email: <span id="student-email"></span></p>
        <p>DOB: <span id="student-dob"></span></p>
        <p>CAO: <span id="student-cao"></span></p>
        <p>Gender<img id="gender-img" src="" alt="Gender Image"></p>
    </div>
    <script>

        // Event Listeners for buttons
        const addButton = document.getElementById("addStudentButton");
        addButton.addEventListener("click", addStudent);
        const removeButton = document.getElementById("removeStudentButton");
        removeButton.addEventListener("click", removeStudent);

        const studentsByCourse = {
            "Course 1": [],
            "Course 2": [],
            "Course 3": [],
        };

        function isValidName(name) {
            const nameCheck = /^[A-Za-z]+(?: [A-Za-z]+)?$/;
            return nameCheck.test(name);
        }
        function isValidEmail(email) {
            const emailCheck = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailCheck.test(email);
        }
        function isValidCAO(caoNumber) {
            const caoCheck = /^L\d{8}$/;
            return caoCheck.test(caoNumber);
        }
        function isDuplicateCAO(caoNumber) {
            for (const [, students] of Object.entries(studentsByCourse)) {
                if (students.some(student => student.caoNumber == caoNumber)) {
                    return true;
                }
            }
            return false;
        }
        function termsValid() {

        }
        function addStudent() {

            // Retrieve values
            const firstNameInput = document.getElementById("firstName");
            const lastNameInput = document.getElementById("lastName");
            const emailInput = document.getElementById("email");
            const caoInput = document.getElementById("caoNumber");
            const genderInput = document.getElementById("gender");
            const courseInput = document.querySelector('input[name="course"]:checked');
            const termsInput = document.getElementById("terms");


            if (!termsInput.checked) {
                alert("You must agree with the terms and conditions");
                return;
            }

            // Validate Input
            const isValidFirstName = isValidName(firstNameInput.value);
            const isValidLastName = isValidName(lastNameInput.value);
            const isValidEmailString = isValidEmail(emailInput.value);
            const isValidCAOString = isValidCAO(caoInput.value);
            const isValidGender = genderInput.value !== "";
            const isValidCourse = courseInput !== null;

            // Change CSS colours depending on validation results
            firstNameInput.classList.toggle("invalid", !isValidFirstName);
            lastNameInput.classList.toggle("invalid", !isValidLastName);
            emailInput.classList.toggle("invalid", !isValidEmailString);
            caoInput.classList.toggle("invalid", !isValidCAOString);
            genderInput.classList.toggle("invalid", !isValidGender);

            if (
                isValidFirstName &&
                isValidLastName &&
                isValidEmailString &&
                isValidCAOString &&
                isValidGender &&
                termsInput.checked &&
                isValidCourse
            ) {

                const caoNumber = caoInput.value.trim();
                if (isDuplicateCAO(caoNumber)) {
                    alert("Duplicate CAO number");
                    return;
                }
            }

            // Combine the separate details into a student profile
            const fullName = `${firstNameInput.value.charAt(0).toUpperCase()}${firstNameInput.value.slice(1).toLowerCase()} ${lastNameInput.value.charAt(0).toUpperCase()}${lastNameInput.value.slice(1).toLowerCase()}`;
            const courseName = courseInput.value;

            const studentsByCourse = { "Computing": [], "Applied": [], "Games": [] };
            studentsByCourse[courseName].push({
                fullName,
                email: emailInput.value,
                caoNumber,
                gender: genderInput.value,
            })

        }

        // Find which course a CAO number is registered to. Required for my removeStudent function
        function getCourseByCAO() {
            for (const course in studentsByCourse) {
                const studentsInCourse = studentsByCourse[course];
                if (studentsInCourse.some(student => student.caoNumber == caoNumber)) {
                    return course;
                }

            }
        }
        function removeStudent() {
            const caoToRemove = prompt("Enter the CAO of the student to remove");
            if (!caoToRemove) {
                alert("Field cannot be empty")
                return;
            }
            const courseName = getCourseByCAO(caoToRemove);
            if (!courseName) {
                alert("Student not found");
                return;
            }

            const indexToRemove = studentsByCourse[courseName].findIndex(student => student.caoNumber == caoToRemove);
            if (indexToRemove !== -1) {
                studentsByCourse[courseName].splice(indexToRemove, 1);
                alert(`Student ${caoToRemove} removed from ${courseName} database. `);
            }
            else {
                alert("Student not found");
            }

        }

    </script>

</body>

</html>